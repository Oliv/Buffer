/*
---
description: Buffer

license: MIT-style

authors: Olivier Gasc (gasc.olivier@gmail.com)

requires:
- Array
- Options
- Asset

provides: [Buffer]
...
*/

var Buffer=new Class({Implements:Options,buffer:{},options:{debug:false,cache:false,path:"/"},initialize:function(e){this.setOptions(e)},get:function(e,t){if(this.buffer[e]!==undefined&&this.buffer[e][t]!==undefined)return this.buffer[e][t];return false},set:function(e,t,n,r){if(this.buffer[e]===undefined)this.buffer[e]={};if(n!==undefined){if(t instanceof Array){var i=t.length,s={},o=0,u=+(new Date);t.each(function(t){if(this.buffer[e][t]===undefined){new Asset.image(this.options.path+t+(this.options.cache?"?"+u:""),{onLoad:function(u){this.buffer[e][t]=u;s[t]=u;if(++o===i)n.apply(this,[s].append(r!==undefined?r instanceof Array?r:[r]:[]))}.bind(this),onError:function(){if(this.options.debug)console.error("Failed to load image",arguments);if(++o===i)n.apply(this,[s].append(r!==undefined?r instanceof Array?r:[r]:[]))}.bind(this),onAbort:function(){if(this.options.debug)console.error("Loading image aborted",arguments);if(++o===i)n.apply(this,[s].append(r!==undefined?r instanceof Array?r:[r]:[]))}.bind(this)})}else{s[t]=this.buffer[e][t];if(++o===i)n.apply(this,[s].append(r!==undefined?r instanceof Array?r:[r]:[]))}}.bind(this))}else{if(this.buffer[e][t]===undefined){new Asset.image(this.options.path+t+"?"+ +(new Date),{onLoad:function(i){this.buffer[e][t]=i;n.apply(this,[i].append(r!==undefined?r instanceof Array?r:[r]:[]))}.bind(this),onError:function(){if(this.options.debug)console.error("Failed to load image",arguments)}.bind(this),onAbort:function(){if(this.options.debug)console.error("Loading image aborted",arguments);if(++o===i)n.apply(this,[s].append(r!==undefined?r instanceof Array?r:[r]:[]))}.bind(this)})}else n.apply(this,[this.buffer[e][t]].append(r!==undefined?r instanceof Array?r:[r]:[]))}}if(t instanceof Array){var a={};t.each(function(t){if(this.buffer[e][t]!==undefined){a[t]=this.buffer[e][t]}}.bind(this));return a}else{return this.buffer[e][t]}},path:function(e){if(e!==undefined)this.options.path=e;return e},remove:function(e,t){if(this.buffer[e]!==undefined&&this.buffer[e][t]!==undefined)delete this.buffer[e][t];return this}})